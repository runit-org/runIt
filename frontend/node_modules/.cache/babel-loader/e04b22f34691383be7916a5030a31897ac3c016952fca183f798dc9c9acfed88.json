{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Manan/Desktop/runIt/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/Manan/Desktop/runIt/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from\"axios\";import store from\"../store\";import jwt_decode from\"jwt-decode\";import{GET_ERRORS,SET_CURRENT_USER}from\"../actions/types\";import Cookies from\"js-cookie\";var setToken=function setToken(token){if(token){axios.defaults.headers.common[\"Authorization\"]=\"Bearer \"+token;}else{delete axios.defaults.headers.common[\"Authorization\"];}};var refreshToken=function refreshToken(){if(Cookies.get(\"token\")){var ref=axios.post(\"http://localhost:8000/api/auth/token/refresh/\",{refresh:Cookies.get(\"token\")});return ref;}else{store.dispatch({type:SET_CURRENT_USER,payload:null});}};var getAccessToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return refreshToken().then(function(res){console.log(res);setToken(res.data.access);var decoded_token=jwt_decode(res.data.access);store.dispatch({type:SET_CURRENT_USER,payload:decoded_token});}).catch(function(error){store.dispatch({type:GET_ERRORS,payload:error.message});store.dispatch({type:SET_CURRENT_USER,payload:null});});case 2:case\"end\":return _context.stop();}},_callee);}));return function getAccessToken(){return _ref.apply(this,arguments);};}();export{setToken,refreshToken,getAccessToken};","map":{"version":3,"names":["axios","store","jwt_decode","GET_ERRORS","SET_CURRENT_USER","Cookies","setToken","token","defaults","headers","common","refreshToken","get","ref","post","refresh","dispatch","type","payload","getAccessToken","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","then","res","console","log","data","access","decoded_token","catch","error","message","stop","apply","arguments"],"sources":["/Users/Manan/Desktop/runIt/frontend/src/securityUtils/setToken.js"],"sourcesContent":["import axios from \"axios\";\nimport store from \"../store\";\nimport jwt_decode from \"jwt-decode\";\nimport { GET_ERRORS, SET_CURRENT_USER } from \"../actions/types\";\nimport Cookies from \"js-cookie\";\n\nconst setToken = (token) => {\n  if (token) {\n    axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n  } else {\n    delete axios.defaults.headers.common[\"Authorization\"];\n  }\n};\n\nconst refreshToken = () => {\n  if (Cookies.get(\"token\")) {\n    const ref = axios.post(\"http://localhost:8000/api/auth/token/refresh/\", {\n      refresh: Cookies.get(\"token\"),\n    });\n    return ref;\n  } else {\n    store.dispatch({\n      type: SET_CURRENT_USER,\n      payload: null,\n    });\n  }\n};\n\nconst getAccessToken = async () => {\n  await refreshToken()\n    .then((res) => {\n      console.log(res);\n      setToken(res.data.access);\n      const decoded_token = jwt_decode(res.data.access);\n      store.dispatch({\n        type: SET_CURRENT_USER,\n        payload: decoded_token,\n      });\n    })\n    .catch((error) => {\n      store.dispatch({\n        type: GET_ERRORS,\n        payload: error.message,\n      });\n      store.dispatch({\n        type: SET_CURRENT_USER,\n        payload: null,\n      });\n    });\n};\n\nexport { setToken, refreshToken, getAccessToken };\n"],"mappings":"kQAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,KAAK,KAAM,UAAU,CAC5B,MAAO,CAAAC,UAAU,KAAM,YAAY,CACnC,OAASC,UAAU,CAAEC,gBAAgB,KAAQ,kBAAkB,CAC/D,MAAO,CAAAC,OAAO,KAAM,WAAW,CAE/B,GAAM,CAAAC,QAAQ,CAAG,QAAX,CAAAA,QAAQA,CAAIC,KAAK,CAAK,CAC1B,GAAIA,KAAK,CAAE,CACTP,KAAK,CAACQ,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,CAAG,SAAS,CAAGH,KAAK,CACpE,CAAC,IAAM,CACL,MAAO,CAAAP,KAAK,CAACQ,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,CACvD,CACF,CAAC,CAED,GAAM,CAAAC,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAA,CAAS,CACzB,GAAIN,OAAO,CAACO,GAAG,CAAC,OAAO,CAAC,CAAE,CACxB,GAAM,CAAAC,GAAG,CAAGb,KAAK,CAACc,IAAI,CAAC,+CAA+C,CAAE,CACtEC,OAAO,CAAEV,OAAO,CAACO,GAAG,CAAC,OAAO,CAC9B,CAAC,CAAC,CACF,MAAO,CAAAC,GAAG,CACZ,CAAC,IAAM,CACLZ,KAAK,CAACe,QAAQ,CAAC,CACbC,IAAI,CAAEb,gBAAgB,CACtBc,OAAO,CAAE,IACX,CAAC,CAAC,CACJ,CACF,CAAC,CAED,GAAM,CAAAC,cAAc,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA,SAAAF,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAE,IAAA,SACf,CAAAlB,YAAY,CAAC,CAAC,CACjBmB,IAAI,CAAC,SAACC,GAAG,CAAK,CACbC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC,CAChBzB,QAAQ,CAACyB,GAAG,CAACG,IAAI,CAACC,MAAM,CAAC,CACzB,GAAM,CAAAC,aAAa,CAAGlC,UAAU,CAAC6B,GAAG,CAACG,IAAI,CAACC,MAAM,CAAC,CACjDlC,KAAK,CAACe,QAAQ,CAAC,CACbC,IAAI,CAAEb,gBAAgB,CACtBc,OAAO,CAAEkB,aACX,CAAC,CAAC,CACJ,CAAC,CAAC,CACDC,KAAK,CAAC,SAACC,KAAK,CAAK,CAChBrC,KAAK,CAACe,QAAQ,CAAC,CACbC,IAAI,CAAEd,UAAU,CAChBe,OAAO,CAAEoB,KAAK,CAACC,OACjB,CAAC,CAAC,CACFtC,KAAK,CAACe,QAAQ,CAAC,CACbC,IAAI,CAAEb,gBAAgB,CACtBc,OAAO,CAAE,IACX,CAAC,CAAC,CACJ,CAAC,CAAC,yBAAAS,QAAA,CAAAa,IAAA,MAAAhB,OAAA,GACL,kBArBK,CAAAL,cAAcA,CAAA,SAAAC,IAAA,CAAAqB,KAAA,MAAAC,SAAA,OAqBnB,CAED,OAASpC,QAAQ,CAAEK,YAAY,CAAEQ,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}