{"ast":null,"code":"import axios from \"axios\";\nimport { GET_USERS, GET_ERRORS, SET_CURRENT_USER, SET_NEW_USER } from \"./types\";\nimport { setToken, refreshToken } from \"../securityUtils/setToken\";\nimport jwt_decode from \"jwt-decode\";\nexport const getUsers = () => async dispatch => {\n  const res = await axios.get(`http://localhost:8000/api/user/all/`); // console.log(res)\n\n  dispatch({\n    type: GET_USERS,\n    payload: res.data\n  });\n};\nexport const createNewUser = (userData, setLoad, setShow, setError) => async dispatch => {\n  try {\n    setLoad(true);\n    const res = await axios.post(\"http://localhost:8000/api/auth/register/\", userData);\n\n    if (res.data.success == \"true\") {\n      setLoad(false);\n      setShow(true);\n      setError(res.data.message);\n    }\n\n    dispatch({\n      type: GET_ERRORS,\n      payload: {}\n    });\n    dispatch({\n      type: SET_NEW_USER,\n      payload: res.data\n    });\n  } catch (error) {\n    setLoad(false);\n    setShow(true);\n    setError(error.response.data.message);\n    dispatch({\n      type: SET_NEW_USER,\n      payload: {}\n    });\n    dispatch({\n      type: GET_ERRORS,\n      payload: error.response.data\n    });\n  }\n};\nexport const login = (LoginRequest, navigate, setLoad, setShow, setError) => async dispatch => {\n  try {\n    //post => login request\n    setLoad(true);\n    const res = await axios.post(\"http://localhost:8000/api/auth/login/\", LoginRequest); //extract token from data\n\n    const refToken = res.data.refresh;\n    const accessToken = res.data.access; //store token in local storage\n\n    localStorage.setItem(\"token\", refToken);\n    localStorage.setItem(\"accessToken\", accessToken); //set token in header\n\n    setToken(accessToken); //get data from response\n\n    const decoded_token = jwt_decode(res.data.access);\n    const decoded = {\n      username: res.data.username\n    };\n    localStorage.setItem(\"username\", decoded.username);\n\n    if (localStorage.getItem(\"token\")) {\n      navigate(\"/posts\");\n    } //dispatch to securityReducer\n\n    /*  dispatch({\n    type: GET_ERRORS,\n    payload: {},\n    }); */\n\n\n    dispatch({\n      type: SET_CURRENT_USER,\n      payload: decoded_token\n    });\n  } catch (error) {\n    setLoad(false);\n    setShow(true);\n    setError(error.response.data.detail);\n    dispatch({\n      type: GET_ERRORS,\n      payload: error.response.data\n    });\n  }\n};\nexport const logout = (refToken, navigate) => async dispatch => {\n  /* const ref = await axios.post(\n    \"http://localhost:8000/api/auth/token/refresh/\",\n    refToken\n  ) */\n  const ref = await refreshToken().then(ref => {\n    console.log(ref.data.access);\n    setToken(ref.data.access);\n    return axios.post(\"http://localhost:8000/api/auth/logout/\", refToken);\n  });\n  /*   const res = await axios.post(\n      \"http://localhost:8000/api/auth/logout/\",\n      refToken\n    ); */\n\n  setToken(false);\n  localStorage.clear(); // navigate(\"/\");\n\n  if (!localStorage.getItem(\"token\")) {\n    navigate(\"/\");\n  }\n\n  dispatch({\n    type: SET_CURRENT_USER,\n    payload: null\n  });\n};\n/* export const getUser = () => async (dispatch) => {\n  const res = await axios.get(`http://localhost:8000/api/user/`);\n  dispatch({\n    type: GET_USER,\n    payload: res.data,\n  });\n}; */","map":{"version":3,"sources":["/Users/mananlodhia/Desktop/Projects/EventMatcher/frontend/frontend/src/actions/securityActions.js"],"names":["axios","GET_USERS","GET_ERRORS","SET_CURRENT_USER","SET_NEW_USER","setToken","refreshToken","jwt_decode","getUsers","dispatch","res","get","type","payload","data","createNewUser","userData","setLoad","setShow","setError","post","success","message","error","response","login","LoginRequest","navigate","refToken","refresh","accessToken","access","localStorage","setItem","decoded_token","decoded","username","getItem","detail","logout","ref","then","console","log","clear"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { GET_USERS, GET_ERRORS, SET_CURRENT_USER, SET_NEW_USER } from \"./types\";\nimport {setToken, refreshToken} from \"../securityUtils/setToken\";\nimport jwt_decode from \"jwt-decode\";\n\nexport const getUsers = () => async (dispatch) => {\n  const res = await axios.get(`http://localhost:8000/api/user/all/`);\n  // console.log(res)\n  dispatch({\n    type: GET_USERS,\n    payload: res.data,\n  });\n};\n\nexport const createNewUser =\n  (userData, setLoad, setShow, setError) => async (dispatch) => {\n    try {\n      setLoad(true);\n      const res = await axios.post(\n        \"http://localhost:8000/api/auth/register/\",\n        userData\n      );\n\n      if (res.data.success == \"true\") {\n        setLoad(false);\n        setShow(true);\n        setError(res.data.message);\n\n      }\n      dispatch({\n        type: GET_ERRORS,\n        payload: {},\n      });\n      dispatch({\n        type: SET_NEW_USER,\n        payload: res.data,\n      });\n    } catch (error) {\n      setLoad(false);\n      setShow(true);\n      setError(error.response.data.message);\n      dispatch({\n        type: SET_NEW_USER,\n        payload: {},\n      });\n      dispatch({\n        type: GET_ERRORS,\n        payload: error.response.data,\n      });\n    }\n  };\n\nexport const login =\n  (LoginRequest, navigate, setLoad, setShow, setError) => async (dispatch) => {\n    try {\n      //post => login request\n      setLoad(true);\n      const res = await axios.post(\n        \"http://localhost:8000/api/auth/login/\",\n        LoginRequest\n      );\n\n      //extract token from data\n      const refToken = res.data.refresh;\n      const accessToken = res.data.access;\n      //store token in local storage\n      localStorage.setItem(\"token\", refToken);\n      localStorage.setItem(\"accessToken\", accessToken);\n      //set token in header\n      setToken(accessToken);\n      //get data from response\n      const decoded_token = jwt_decode(res.data.access);\n      const decoded = {\n        username: res.data.username,\n      };\n\n      localStorage.setItem(\"username\", decoded.username);\n      if (localStorage.getItem(\"token\")) {\n        navigate(\"/posts\");\n      }\n\n      //dispatch to securityReducer\n      /*  dispatch({\n      type: GET_ERRORS,\n      payload: {},\n    }); */\n      dispatch({\n        type: SET_CURRENT_USER,\n        payload: decoded_token,\n      });\n    } catch (error) {\n      setLoad(false);\n      setShow(true);\n      setError(error.response.data.detail);\n      dispatch({\n        type: GET_ERRORS,\n        payload: error.response.data,\n      });\n    }\n  };\n\nexport const logout = (refToken, navigate) => async (dispatch) => {\n  /* const ref = await axios.post(\n    \"http://localhost:8000/api/auth/token/refresh/\",\n    refToken\n  ) */const ref = await refreshToken().then(ref => {\n    console.log(ref.data.access)\n    setToken(ref.data.access);\n    return  axios.post(\n      \"http://localhost:8000/api/auth/logout/\",\n      refToken\n    );\n  })\n  \n/*   const res = await axios.post(\n    \"http://localhost:8000/api/auth/logout/\",\n    refToken\n  ); */\n\n  setToken(false);\n  localStorage.clear();\n  // navigate(\"/\");\n  if (!localStorage.getItem(\"token\")) {\n    navigate(\"/\");\n  }\n  dispatch({\n    type: SET_CURRENT_USER,\n    payload: null,\n  });\n};\n\n/* export const getUser = () => async (dispatch) => {\n  const res = await axios.get(`http://localhost:8000/api/user/`);\n  dispatch({\n    type: GET_USER,\n    payload: res.data,\n  });\n}; */\n"]},"metadata":{},"sourceType":"module"}